markdown

# Сценарий Apache Ant для сборки проекта "Веб-программирование" (Лабораторная работа №3)

Данный сценарий Apache Ant автоматизирует процессы компиляции, тестирования и упаковки в jar-архив кода проекта. Каждый этап сборки реализован в виде отдельной цели (target). Все переменные и константы проекта вынесены в файл параметров.

## Файл параметров (`build.properties`)

Все переменные и константы, используемые в сценарии, определены в отдельном файле `build.properties`. Это обеспечивает удобство конфигурации и модификации параметров сборки без изменения основного сценария Ant.

## Цели сборки (Targets)

### `compile`

- **Описание:** Компилирует исходные коды проекта.
- **Действия:** Использует задачу `<javac>` для компиляции файлов `.java`, расположенных в каталоге, указанном в файле параметров (`src.dir`), и помещает скомпилированные классы в каталог, указанный в файле параметров (`build.dir`).

### `build`

- **Описание:** Компилирует исходные коды проекта и упаковывает их в исполняемый jar-архив.
- **Зависимости:** Зависит от цели `compile`, которая выполняется перед упаковкой.
- **Действия:**
  - Вызывает цель `compile`.
  - Использует задачу `<jar>` для создания jar-архива, имя которого определено в файле параметров (`jar.name`).
  - Файл `MANIFEST.MF`, расположенный в каталоге, указанном в файле параметров (`manifest.dir`), включается в jar-архив. Этот файл содержит информацию о версии (`Implementation-Version`) и главном запускаемом классе (`Main-Class`), которые также определены в файле параметров. Jar-архив помещается в каталог, указанный в файле параметров (`dist.dir`).

### `clean`

- **Описание:** Удаляет скомпилированные классы проекта и все временные файлы.
- **Действия:** Использует задачу `<delete>` для удаления каталогов, указанных в файле параметров (`build.dir` и `dist.dir`).

### `test`

- **Описание:** Запускает JUnit-тесты проекта.
- **Зависимости:** Зависит от цели `build`, обеспечивая предварительную сборку проекта.
- **Действия:**
  - Вызывает цель `build`.
  - Добавляет каталог с скомпилированными классами (`build.dir`) и jar-файлы библиотек JUnit (указанные в файле параметров как `lib.dir`) в classpath.
  - Использует задачу `<junit>` для запуска тестов, расположенных в каталоге, указанном в файле параметров (`test.dir`). Результаты тестов могут быть записаны в файлы отчетов в формате XML.

### `xml`

- **Описание:** Выполняет валидацию всех XML-файлов в проекте.
- **Действия:** Использует задачу `<xmlvalidate>` для проверки XML-файлов, расположенных в каталоге, указанном в файле параметров (`xml.dir`), на соответствие DTD или XML Schema, указанным в файле параметров.

### `scp`

- **Описание:** Перемещает собранный проект по протоколу SCP на удаленный сервер.
- **Зависимости:** Зависит от цели `build`, обеспечивая наличие собранного jar-архива.
- **Действия:**
  - Вызывает цель `build`.
  - Использует задачу `<scp>` для копирования jar-архива (из каталога `dist.dir`) на сервер, адрес, имя пользователя и путь на котором определены в файле параметров (`scp.host`, `scp.user`, `scp.remotedir`). Для аутентификации может использоваться пароль или приватный ключ, параметры которых также определены в файле параметров.

### `native2ascii`

- **Описание:** Преобразует файлы локализации в формат `native2ascii`.
- **Действия:** Использует задачу `<native2ascii>` для обработки файлов с расширением, указанным в файле параметров (`i18n.files`), расположенных в каталоге, указанном в файле параметров (`i18n.dir`). Результат сохраняется в каталог, указанный в файле параметров (`i18n.dest.dir`).

### `doc`

- **Описание:** Добавляет в `MANIFEST.MF` MD5 и SHA-1 хеш-суммы файлов проекта, а также генерирует и добавляет в архив Javadoc по всем классам проекта.
- **Зависимости:** Зависит от цели `build`.
- **Действия:**
  - Вызывает цель `build`.
  - Использует задачу `<checksum>` для вычисления MD5 и SHA-1 хеш-сумм всех файлов в собранном jar-архиве и добавляет эти значения в файл `MANIFEST.MF`.
  - Использует задачу `<javadoc>` для генерации документации Javadoc на основе исходных кодов, расположенных в каталоге `src.dir`, и помещает ее в каталог, указанный в файле параметров (`doc.dir`).
  - Обновляет jar-архив, добавляя сгенерированную документацию Javadoc.

### `music`

- **Описание:** Воспроизводит музыкальный файл по завершению сборки.
- **Зависимости:** Зависит от цели `build`.
- **Действия:**
  - Вызывает цель `build`.
  - Использует задачу `<exec>` для запуска внешнего приложения (например, медиаплеера) и воспроизведения музыкального файла, путь к которому указан в файле параметров (`music.file`).

### `env`

- **Описание:** Осуществляет сборку и запуск программы в альтернативных окружениях.
- **Действия:**
  - Использует задачу `<property>` для установки свойств `build.compiler` (версия Java) и `jvm.args` (аргументы виртуальной машины) на основе значений, определенных в файле параметров для выбранного окружения.
  - Вызывает цель `build` для компиляции с использованием указанной версии Java.
  - Использует задачу `<java>` для запуска собранного jar-архива с указанными аргументами JVM.

### `team`

- **Описание:** Получает из Git-репозитория 4 предыдущие ревизии, собирает их и упаковывает полученные jar-файлы в zip-архив.
- **Действия:**
  - Использует задачу `<exec>` с командой `git checkout` для получения каждой из 4 предыдущих ревизий (например, используя `HEAD~1`, `HEAD~2` и т.д.).
  - Для каждой полученной ревизии вызывает цель `build` для сборки проекта. Полученные jar-файлы сохраняются с различными именами или в отдельные каталоги.
  - Использует задачу `<zip>` для упаковки всех полученных jar-файлов в zip-архив, имя которого определено в файле параметров (`team.zip.name`), расположенный в каталоге `dist.dir`.

### `alt`

- **Описание:** Создает альтернативную версию программы с измененными именами переменных и классов и упаковывает ее в jar-архив.
- **Действия:**
  - Использует задачи `<replace>` или `<replaceregexp>` для замены имен переменных и классов в исходных файлах на новые имена, определенные в файле параметров (`alt.replacements.file`). Временные измененные файлы могут быть созданы в отдельном каталоге.
  - Вызывает цель `build` для компиляции и упаковки измененных исходных файлов в отдельный jar-архив с именем, определенным в файле параметров (`alt.jar.name`).
  - Очищает временные измененные файлы после сборки.

### `report`

- **Описание:** В случае успешного прохождения тестов сохраняет отчет JUnit в формате XML, добавляет его в репозиторий Git и выполняет commit.
- **Зависимости:** Зависит от цели `test`.
- **Действия:**
  - Вызывает цель `test`.
  - Использует задачу `<condition>` для проверки, были ли тесты пройдены успешно (например, анализируя сгенерированный XML-отчет JUnit).
  - Если тесты пройдены успешно:
    - Использует задачу `<copy>` для сохранения XML-отчета JUnit в указанный каталог.
    - Использует задачу `<exec>` с командами `git add` и `git commit` для добавления отчета в репозиторий Git и выполнения коммита. Сообщение коммита может быть определено в файле параметров (`report.commit.message`).

### `diff`

- **Описание:** Проверяет состояние рабочей копии и, если изменения не касаются классов, указанных в файле параметров, выполняет commit в репозиторий SVN.
- **Действия:**
  - Использует задачу `<exec>` с командой `svn status` для получения информации о состоянии рабочей копии SVN.
  - Использует задачу `<condition>` и `<contains>` для проверки, что в выводе `svn status` отсутствуют изменения файлов, имена которых соответствуют шаблонам, указанным в файле параметров (`diff.excluded.classes`).
  - Если изменения не касаются исключенных классов, использует задачу `<exec>` с командой `svn commit` для выполнения коммита в репозиторий SVN. Сообщение коммита может быть определено в файле параметров (`diff.commit.message`).

### `history`

- **Описание:** Если проект не удается скомпилировать, загружает предыдущие версии из Git-репозитория до тех пор, пока сборка не станет успешной или не будет получена самая первая ревизия. Формирует diff для файлов из последней рабочей ревизии.
- **Действия:**
  - Использует задачу `<trycatch>` для обработки исключений, возникающих при выполнении цели `compile`.
  - В блоке `try` вызывает цель `compile`.
  - В блоке `catch`:
    - Использует задачу `<exec>` с командой `git checkout HEAD~1` для перехода к предыдущей ревизии.
    - Повторяет попытку компиляции. Этот процесс продолжается до тех пор, пока компиляция не пройдет успешно или не будет достигнута первая ревизия (что можно определить, например, по ошибке `git checkout`).
    - Если найдена рабочая ревизия, выполняет `git checkout HEAD` для возврата к последней неудачной ревизии.
    - Использует задачу `<exec>` с командой `git diff <working_revision_hash> HEAD` (где `<working_revision_hash>` - хеш последней успешно скомпилированной ревизии) для формирования diff измененных файлов.
    - Сохраняет результаты diff в файл, имя которого определено в файле параметров (`history.diff.file`).

## Вопросы к защите лабораторной работы:

1.  **Тестирование ПО. Цель тестирования, виды тестирования.**
2.  **Модульное тестирование, основные принципы и используемые подходы.**
3.  **Пакет JUnit, основные API.**
4.  **Системы автоматической сборки. Назначение, принципы работы, примеры систем.**
5.  **Утилита make. Make-файлы, цели и правила.**
6.  **Утилита Ant. Сценарии сборки, цели и команды.**
